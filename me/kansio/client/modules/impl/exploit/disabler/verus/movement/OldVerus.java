package me.kansio.client.modules.impl.exploit.disabler.verus.movement;

import me.kansio.client.modules.impl.exploit.disabler.*;
import java.util.*;
import net.minecraft.network.*;
import me.kansio.client.utils.math.*;
import me.kansio.client.utils.network.*;
import me.kansio.client.event.impl.*;
import net.minecraft.network.play.client.*;
import net.minecraft.network.play.server.*;

public class OldVerus extends DisablerMode
{
    private /* synthetic */ LinkedList<Packet> packetQueue;
    private /* synthetic */ boolean expectedTeleport;
    private /* synthetic */ Stopwatch timer;
    
    public OldVerus() {
        super("Old Verus Movement");
        this.packetQueue = new LinkedList<Packet>();
        this.timer = new Stopwatch();
    }
    
    @Override
    public void onEnable() {
        this.timer.resetTime();
        this.expectedTeleport = false;
    }
    
    @Override
    public void onUpdate(final UpdateEvent lIIlIIllIIIll) {
        if (!this.shouldRun()) {
            this.expectedTeleport = false;
            this.packetQueue.clear();
            return;
        }
        if (this.timer.timeElapsed(260L)) {
            this.timer.resetTime();
            if (!this.packetQueue.isEmpty()) {
                PacketUtil.sendPacketNoEvent(this.packetQueue.poll());
            }
        }
    }
    
    @Override
    public void onPacket(final PacketEvent lIIlIIllIlIIl) {
        if (!this.shouldRun()) {
            return;
        }
        if (lIIlIIllIlIIl.getPacket() instanceof C0FPacketConfirmTransaction || lIIlIIllIlIIl.getPacket() instanceof C00PacketKeepAlive) {
            short lIIlIIllIllIl = -1;
            if (lIIlIIllIlIIl.getPacket() instanceof C0FPacketConfirmTransaction) {
                lIIlIIllIllIl = lIIlIIllIlIIl.getPacket().getUid();
            }
            if (lIIlIIllIllIl != -1 && this.isInventory(lIIlIIllIllIl)) {
                return;
            }
            this.packetQueue.add(lIIlIIllIlIIl.getPacket());
        }
        if (lIIlIIllIlIIl.getPacket() instanceof C03PacketPlayer) {
            final C03PacketPlayer lIIlIIllIllII = lIIlIIllIlIIl.getPacket();
            if (OldVerus.mc.thePlayer.ticksExisted % 25 == 0) {
                this.expectedTeleport = true;
                lIIlIIllIllII.setMoving(false);
                lIIlIIllIllII.y = -0.015625;
                lIIlIIllIllII.onGround = false;
            }
        }
        if (lIIlIIllIlIIl.getPacket() instanceof S08PacketPlayerPosLook && this.expectedTeleport) {
            final S08PacketPlayerPosLook lIIlIIllIlIll = lIIlIIllIlIIl.getPacket();
            this.expectedTeleport = false;
            lIIlIIllIlIIl.setCancelled(true);
            PacketUtil.sendPacketNoEvent(new C03PacketPlayer.C06PacketPlayerPosLook(lIIlIIllIlIll.getX(), lIIlIIllIlIll.getY(), lIIlIIllIlIll.getZ(), lIIlIIllIlIll.getYaw(), lIIlIIllIlIll.getPitch(), true));
        }
    }
    
    boolean isInventory(final short lIIlIIlIllllI) {
        return lIIlIIlIllllI > 0 && lIIlIIlIllllI < 100;
    }
    
    boolean shouldRun() {
        return OldVerus.mc.thePlayer != null && OldVerus.mc.thePlayer.ticksExisted > 5;
    }
}
